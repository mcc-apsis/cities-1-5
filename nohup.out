###################################
Starting     NMF.py with K=40, ngrame=1 and n_features=50000
7333 documents found
Extracting tf-idf features for NMF...
done in 34.562s.
4004
Adding features to db
done in 12.817s.
Traceback (most recent call last):
  File "code/nmf_multi.py", line 390, in <module>
    main()
  File "code/nmf_multi.py", line 238, in main
    topic_ids = db.add_topics(K)
  File "/home/galm/software/tmv/BasicBrowser/db.py", line 82, in add_topics
    topicrow = Topic(title=title,run_id=run_id)
  File "/usr/local/lib/python3.4/dist-packages/django/db/models/base.py", line 537, in __init__
    setattr(self, field.name, rel_obj)
  File "/usr/local/lib/python3.4/dist-packages/django/db/models/fields/related_descriptors.py", line 211, in __set__
    self.field.remote_field.model._meta.object_name,
ValueError: Cannot assign "51": "Topic.run_id" must be a "RunStats" instance.
###################################
Starting     NMF.py with K=40, ngrame=1 and n_features=50000
7333 documents found
Extracting tf-idf features for NMF...
done in 33.701s.
4004
Adding features to db
done in 12.327s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 2.131s.
Adding topicterms to db
done in 6.595s.
making sparse matrix
done in 0.075s.
adding 31506 doctopics to the db
done in 61.342s.
Making the objects took in 1.637s.
Adding the objects took in 59.498s.
updating features in db
done in 11.810s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 7.713s.
Adding topicterms to db
done in 4.624s.
making sparse matrix
done in 0.161s.
adding 50882 doctopics to the db
done in 68.571s.
Making the objects took in 2.040s.
Adding the objects took in 66.275s.
updating features in db
done in 16.718s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 7.175s.
Adding topicterms to db
done in 3.795s.
making sparse matrix
done in 0.267s.
adding 62010 doctopics to the db
done in 76.625s.
Making the objects took in 1.973s.
Adding the objects took in 74.391s.
updating features in db
done in 12.406s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 10.176s.
Adding topicterms to db
done in 4.622s.
making sparse matrix
done in 0.386s.
adding 71731 doctopics to the db
done in 95.506s.
Making the objects took in 2.044s.
Adding the objects took in 93.156s.
updating features in db
done in 12.207s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 15.123s.
Adding topicterms to db
done in 5.912s.
making sparse matrix
done in 0.357s.
adding 78527 doctopics to the db
done in 110.883s.
Making the objects took in 2.149s.
Adding the objects took in 108.447s.
updating features in db
done in 14.917s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 12.962s.
Adding topicterms to db
done in 3.862s.
making sparse matrix
done in 0.449s.
adding 84305 doctopics to the db
done in 116.341s.
Making the objects took in 2.362s.
Adding the objects took in 113.659s.
updating features in db
done in 15.136s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 28.201s.
Adding topicterms to db
done in 5.014s.
making sparse matrix
done in 0.771s.
adding 91575 doctopics to the db
done in 119.324s.
Making the objects took in 2.396s.
Adding the objects took in 116.566s.
updating features in db
done in 12.219s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 22.273s.
Adding topicterms to db
done in 6.118s.
making sparse matrix
done in 0.764s.
adding 97199 doctopics to the db
done in 130.726s.
Making the objects took in 2.397s.
Adding the objects took in 127.978s.
updating features in db
done in 13.044s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 25.757s.
Adding topicterms to db
done in 3.746s.
making sparse matrix
done in 1.166s.
adding 109061 doctopics to the db
done in 151.343s.
Making the objects took in 4.061s.
Adding the objects took in 146.692s.
updating features in db
done in 17.756s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 48.903s.
Adding topicterms to db
done in 3.952s.
making sparse matrix
done in 1.716s.
adding 97957 doctopics to the db
done in 145.887s.
Making the objects took in 2.472s.
Adding the objects took in 143.062s.
done! total time: 24 minutes and 47 seconds
a maximum of 294.58 MB was used
Loading required package: methods
Loading required package: DBI
Warning messages:
1: replacing previous import ‘dplyr::union’ by ‘igraph::union’ when loading ‘scimetrix’ 
2: replacing previous import ‘dplyr::as_data_frame’ by ‘igraph::as_data_frame’ when loading ‘scimetrix’ 
3: replacing previous import ‘dplyr::groups’ by ‘igraph::groups’ when loading ‘scimetrix’ 
4: replacing previous import ‘dplyr::%>%’ by ‘igraph::%>%’ when loading ‘scimetrix’ 
5: replacing previous import ‘igraph::crossing’ by ‘tidyr::crossing’ when loading ‘scimetrix’ 
6: replacing previous import ‘igraph::%>%’ by ‘tidyr::%>%’ when loading ‘scimetrix’ 

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

Loading required package: NLP
[1] 7077  449
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.009644 0.047435 0.056399 0.059101 0.066273 0.189756 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  382.0   545.5   746.0   949.1  1066.5  8396.0 
[1] 7077  303
Optimal number of topics = 3
There were 14 warnings (use warnings() to see them)
There were 14 warnings (use warnings() to see them)
Loading required package: methods
Loading required package: DBI
Warning messages:
1: replacing previous import ‘dplyr::union’ by ‘igraph::union’ when loading ‘scimetrix’ 
2: replacing previous import ‘dplyr::as_data_frame’ by ‘igraph::as_data_frame’ when loading ‘scimetrix’ 
3: replacing previous import ‘dplyr::groups’ by ‘igraph::groups’ when loading ‘scimetrix’ 
4: replacing previous import ‘dplyr::%>%’ by ‘igraph::%>%’ when loading ‘scimetrix’ 
5: replacing previous import ‘igraph::crossing’ by ‘tidyr::crossing’ when loading ‘scimetrix’ 
6: replacing previous import ‘igraph::%>%’ by ‘tidyr::%>%’ when loading ‘scimetrix’ 

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

Loading required package: NLP
[1] 7077  449
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.009644 0.047435 0.056399 0.059101 0.066273 0.189756 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  382.0   545.5   746.0   949.1  1066.5  8396.0 
[1] 7077  303

Grab a cup of coffee this could take a while...

10 of 60 iterations (Current: 02:51:55; Elapsed: 8 mins)
20 of 60 iterations (Current: 03:14:06; Elapsed: 30.2 mins; Remaining: ~236.5 mins)
30 of 60 iterations (Current: 03:49:04; Elapsed: 65.1 mins; Remaining: ~192.6 mins)
40 of 60 iterations (Current: 04:38:14; Elapsed: 114.3 mins; Remaining: ~141.5 mins)
###################################
Starting     NMF.py with K=40, ngrame=1 and n_features=50000
7077 documents found
Extracting tf-idf features for NMF...
done in 33.661s.
3890
Adding features to db
done in 14.964s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 5.262s.
Adding topicterms to db
done in 12.225s.
making sparse matrix
done in 0.176s.
adding 55674 doctopics to the db
done in 114.053s.
Making the objects took in 1.818s.
Adding the objects took in 111.998s.
updating features in db
done in 17.746s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 5.697s.
Adding topicterms to db
done in 3.764s.
making sparse matrix
done in 0.197s.
adding 54920 doctopics to the db
done in 95.098s.
Making the objects took in 1.748s.
Adding the objects took in 93.109s.
updating features in db
done in 12.216s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 5.844s.
Adding topicterms to db
done in 4.280s.
making sparse matrix
done in 0.189s.
adding 57306 doctopics to the db
done in 100.938s.
Making the objects took in 1.837s.
Adding the objects took in 98.849s.
updating features in db
done in 12.120s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 5.669s.
Adding topicterms to db
done in 6.414s.
making sparse matrix
done in 0.215s.
adding 57659 doctopics to the db
done in 101.804s.
Making the objects took in 1.821s.
Adding the objects took in 99.688s.
updating features in db
done in 12.134s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 9.502s.
Adding topicterms to db
done in 5.132s.
making sparse matrix
done in 0.225s.
adding 57822 doctopics to the db
done in 91.566s.
Making the objects took in 1.866s.
Adding the objects took in 89.432s.
updating features in db
done in 16.835s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 12.622s.
Adding topicterms to db
done in 3.609s.
making sparse matrix
done in 0.200s.
adding 59475 doctopics to the db
done in 103.404s.
Making the objects took in 1.790s.
Adding the objects took in 101.367s.
updating features in db
done in 12.214s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 6.362s.
Adding topicterms to db
done in 3.528s.
making sparse matrix
done in 0.216s.
adding 61034 doctopics to the db
done in 111.013s.
Making the objects took in 1.859s.
Adding the objects took in 108.888s.
updating features in db
done in 12.207s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 8.075s.
Adding topicterms to db
done in 5.199s.
making sparse matrix
done in 0.278s.
adding 61176 doctopics to the db
done in 98.451s.
Making the objects took in 1.935s.
Adding the objects took in 96.239s.
updating features in db
done in 12.300s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 8.062s.
Adding topicterms to db
done in 6.744s.
making sparse matrix
done in 0.286s.
adding 64037 doctopics to the db
done in 110.682s.
Making the objects took in 2.177s.
Adding the objects took in 108.187s.
updating features in db
done in 17.544s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 10.100s.
Adding topicterms to db
done in 3.612s.
making sparse matrix
done in 0.292s.
adding 63000 doctopics to the db
50 of 60 iterations (Current: 05:42:33; Elapsed: 178.6 mins; Remaining: ~77.8 mins)
done in 108.407s.
Making the objects took in 1.961s.
Adding the objects took in 106.172s.
updating features in db
done in 13.617s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 9.608s.
Adding topicterms to db
done in 6.252s.
making sparse matrix
done in 0.317s.
adding 63206 doctopics to the db
python3: can't open file '/home/galm/software/tmv/BasicBrowser/update_all__topics.py': [Errno 2] No such file or directory
done in 111.024s.
Making the objects took in 1.939s.
Adding the objects took in 108.795s.
done! total time: 24 minutes and 49 seconds
a maximum of 249.484 MB was used
60 of 60 iterations (Current: 07:00:53; Elapsed: 256.9 mins; Remaining: ~0 mins)
Optimal number of topics = 60
Traceback (most recent call last):
  File "code/nmf_multi.py", line 51, in <module>
    import db as db
  File "/home/galm/software/tmv/BasicBrowser/db.py", line 12, in <module>
    django.setup()
  File "/usr/local/lib/python3.4/dist-packages/django/__init__.py", line 27, in setup
    apps.populate(settings.INSTALLED_APPS)
  File "/usr/local/lib/python3.4/dist-packages/django/apps/registry.py", line 85, in populate
    app_config = AppConfig.create(entry)
  File "/usr/local/lib/python3.4/dist-packages/django/apps/config.py", line 116, in create
    mod = import_module(mod_path)
  File "/usr/lib/python3.4/importlib/__init__.py", line 109, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/apps.py", line 12, in <module>
    from debug_toolbar.middleware import DebugToolbarMiddleware
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/middleware.py", line 17, in <module>
    from debug_toolbar.toolbar import DebugToolbar
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/toolbar.py", line 151, in <module>
    urlpatterns = DebugToolbar.get_urls()
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/toolbar.py", line 145, in get_urls
    for panel_class in cls.get_panel_classes():
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/toolbar.py", line 118, in get_panel_classes
    mod = import_module(panel_module)
  File "/usr/lib/python3.4/importlib/__init__.py", line 109, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/panels/templates/__init__.py", line 1, in <module>
    from debug_toolbar.panels.templates.panel import TemplatesPanel  # noqa
  File "/usr/local/lib/python3.4/dist-packages/debug_toolbar/panels/templates/panel.py", line 12, in <module>
    from django.test.signals import template_rendered
  File "/usr/local/lib/python3.4/dist-packages/django/test/__init__.py", line 5, in <module>
    from django.test.client import Client, RequestFactory
  File "/usr/local/lib/python3.4/dist-packages/django/test/client.py", line 22, in <module>
    from django.test.utils import ContextList
  File "/usr/local/lib/python3.4/dist-packages/django/test/utils.py", line 28, in <module>
    import jinja2
  File "/usr/local/lib/python3.4/dist-packages/jinja2/__init__.py", line 33, in <module>
    from jinja2.environment import Environment, Template
  File "/usr/local/lib/python3.4/dist-packages/jinja2/environment.py", line 22, in <module>
    from jinja2.lexer import get_lexer, TokenStream
  File "/usr/local/lib/python3.4/dist-packages/jinja2/lexer.py", line 57, in <module>
    name_re = _make_name_re()
  File "/usr/local/lib/python3.4/dist-packages/jinja2/lexer.py", line 46, in _make_name_re
    _stringdefs.xid_continue))
  File "/usr/lib/python3.4/re.py", line 223, in compile
    return _compile(pattern, flags)
  File "/usr/lib/python3.4/re.py", line 294, in _compile
    p = sre_compile.compile(pattern, flags)
  File "/usr/lib/python3.4/sre_compile.py", line 568, in compile
    p = sre_parse.parse(p, flags)
  File "/usr/lib/python3.4/sre_parse.py", line 760, in parse
    p = _parse_sub(source, pattern, 0)
  File "/usr/lib/python3.4/sre_parse.py", line 370, in _parse_sub
    itemsappend(_parse(source, state))
  File "/usr/lib/python3.4/sre_parse.py", line 494, in _parse
    code1 = LITERAL, ord(this)
KeyboardInterrupt
###################################
Starting     NMF.py with K=40, ngrame=1 and n_features=50000
7077 documents found
Extracting tf-idf features for NMF...
done in 33.575s.
3890
Adding features to db
done in 11.700s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 2.772s.
Adding topicterms to db
done in 3.322s.
making sparse matrix
done in 0.112s.
adding 41275 doctopics to the db
done in 72.339s.
Making the objects took in 1.602s.
Adding the objects took in 70.511s.
updating features in db
done in 19.234s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 3.048s.
Adding topicterms to db
done in 3.084s.
making sparse matrix
done in 0.111s.
adding 42044 doctopics to the db
done in 77.298s.
Making the objects took in 1.608s.
Adding the objects took in 75.463s.
updating features in db
done in 14.824s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 3.212s.
Adding topicterms to db
done in 3.799s.
making sparse matrix
done in 0.111s.
adding 44077 doctopics to the db
done in 67.911s.
Making the objects took in 1.617s.
Adding the objects took in 66.007s.
updating features in db
done in 19.429s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 3.349s.
Adding topicterms to db
done in 3.271s.
making sparse matrix
done in 0.120s.
adding 45298 doctopics to the db
done in 85.252s.
Making the objects took in 1.700s.
Adding the objects took in 83.274s.
updating features in db
done in 11.924s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 3.436s.
Adding topicterms to db
done in 4.949s.
making sparse matrix
done in 0.141s.
adding 46215 doctopics to the db
done in 95.591s.
Making the objects took in 1.715s.
Adding the objects took in 93.583s.
updating features in db
done in 11.632s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 4.093s.
Adding topicterms to db
done in 4.612s.
making sparse matrix
done in 0.149s.
adding 48680 doctopics to the db
done in 80.417s.
Making the objects took in 1.660s.
Adding the objects took in 78.458s.
updating features in db
done in 17.844s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 4.159s.
Adding topicterms to db
done in 4.339s.
making sparse matrix
done in 0.145s.
adding 49638 doctopics to the db
done in 96.329s.
Making the objects took in 1.698s.
Adding the objects took in 94.320s.
updating features in db
done in 11.934s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 4.123s.
Adding topicterms to db
done in 4.507s.
making sparse matrix
done in 0.147s.
adding 49638 doctopics to the db
done in 85.741s.
Making the objects took in 1.626s.
Adding the objects took in 83.814s.
updating features in db
done in 12.137s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 6.138s.
Adding topicterms to db
done in 6.884s.
making sparse matrix
done in 0.177s.
adding 53244 doctopics to the db
done in 89.299s.
Making the objects took in 1.744s.
Adding the objects took in 87.226s.
updating features in db
done in 16.755s.
Fitting the NMF model with tf-idf features, n_samples=1000 and n_features=50000...
done in 5.059s.
Adding topicterms to db
done in 6.515s.
making sparse matrix
done in 0.183s.
adding 54882 doctopics to the db
74
done! total time: 0 minutes and 1.19 seconds
a maximum of 141.068 MB was used
75
done! total time: 0 minutes and 1.5 seconds
a maximum of 141.048 MB was used
76
done! total time: 0 minutes and 1.54 seconds
a maximum of 141.364 MB was used
77
done! total time: 0 minutes and 1.57 seconds
a maximum of 141.588 MB was used
78
done! total time: 0 minutes and 1.51 seconds
a maximum of 141.696 MB was used
79
done! total time: 0 minutes and 1.61 seconds
a maximum of 142.6 MB was used
81
done! total time: 0 minutes and 2.14 seconds
a maximum of 144.216 MB was used
82
done! total time: 0 minutes and 1.99 seconds
a maximum of 145.208 MB was used
83
done! total time: 0 minutes and 2.17 seconds
a maximum of 144.268 MB was used
84
done! total time: 0 minutes and 2.02 seconds
a maximum of 144.4 MB was used
80
done! total time: 0 minutes and 1.72 seconds
a maximum of 143.9 MB was used
85
done! total time: 0 minutes and 0.6 seconds
a maximum of 133.944 MB was used
86
done! total time: 0 minutes and 0.73 seconds
a maximum of 134.664 MB was used
87
done! total time: 0 minutes and 0.66 seconds
a maximum of 135.96 MB was used
88
done! total time: 0 minutes and 0.87 seconds
a maximum of 135.904 MB was used
89
done! total time: 0 minutes and 0.81 seconds
a maximum of 135.644 MB was used
90
done! total time: 0 minutes and 0.83 seconds
a maximum of 137.172 MB was used
91
done! total time: 0 minutes and 1.02 seconds
a maximum of 137.708 MB was used
92
done! total time: 0 minutes and 0.94 seconds
a maximum of 137.672 MB was used
93
done! total time: 0 minutes and 1.16 seconds
a maximum of 139.588 MB was used
94
done! total time: 0 minutes and 1.1 seconds
a maximum of 140.34 MB was used
74
75
76
77
78
79
81
82
83
84
80
85
86
87
88
89
90
91
92
93
94
done in 81.226s.
Making the objects took in 1.891s.
Adding the objects took in 79.001s.
done! total time: 20 minutes and 55 seconds
a maximum of 243.16 MB was used
